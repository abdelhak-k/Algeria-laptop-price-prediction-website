{% extends 'predictor/base.html' %}
{% load static %}

{% block title %}Predict Laptop Price - Algerian Market{% endblock %}

{% block content %}
<style>
    #predict-submit-btn[data-loading="true"] {
        cursor: wait;
        pointer-events: none;
    }
    #predict-submit-btn .btn-predict-loading .spinner-border {
        border-color: rgba(255,255,255,.3);
        border-right-color: #fff;
    }
</style>
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card">
            <div class="card-header text-center">
                <h2><i class="fas fa-laptop me-2"></i></h2>
                <p class="mb-0 mt-2 opacity-75">Enter your laptop specifications to get an estimated price in DZD</p>
                <div class="alert alert-info mt-3 mb-0" style="font-size: 0.9rem;">
                    <i class="fas fa-info-circle me-1"></i>
                    <strong>Note:</strong> All results are based on the quality of the data. The model was trained on old data (2018-2025), so you may notice some variations in the price.
                </div>
            </div>
            <div class="card-body p-4">
                <form id="predict-form" method="post" action="{% url 'predictor:home' %}">
                    {% csrf_token %}
                    
                    <!-- Basic Information -->
                    <div class="form-section">
                        <div class="section-icon">
                            <div class="icon-wrapper">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <h5 class="mb-0">Basic Information</h5>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Brand</label>
                                {{ form.brand }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Series</label>
                                {{ form.series }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Condition</label>
                                {{ form.condition }}
                                <small class="text-muted d-block mt-1">
                                    <strong>Please make sure to enter the right condition:</strong><br>
                                    "Cartona" = Never used<br>
                                    "Caba" = Good condition<br>
                                    "Used" = Average condition
                                </small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Listing Year</label>
                                {{ form.listing_year }}
                            </div>
                        </div>
                    </div>
                    
                    <!-- CPU Specifications -->
                    <div class="form-section">
                        <div class="section-icon">
                            <div class="icon-wrapper">
                                <i class="fas fa-microchip"></i>
                            </div>
                            <h5 class="mb-0">CPU Specifications</h5>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">CPU Brand</label>
                                {{ form.cpu_brand }}
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">CPU Family</label>
                                {{ form.cpu_family }}
                            </div>
                            <div class="col-md-3 mb-3" id="generation-container">
                                <label class="form-label">Generation</label>
                                {{ form.cpu_generation }}
                                <small class="text-muted" id="generation-help"></small>
                                <div id="ultra-note" style="display:none;">
                                <small class="text-muted d-block mt-1">
                                    <strong>Note:</strong> Ultra CPUs generations are only 1, 2, or 3.<br>
                                    They correspond to Ultra 3-series, 2-series, 1-series.<br>
                                    Any other generation is not valid for Ultra CPUs.
                                </small>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3" id="suffix-container">
                                <label class="form-label">CPU Suffix</label>
                                {{ form.cpu_suffix }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.is_pro }}
                                    <label class="form-check-label">Professional/Business CPU</label>
                                </div>
                                <small class="text-muted d-block mt-1 ms-4">
                                    Check this if the CPU contains "Pro" in it (e.g., PRO Ryzen, M1 Pro)
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GPU Specifications -->
                    <div class="form-section">
                        <div class="section-icon">
                            <div class="icon-wrapper">
                                <i class="fas fa-tv"></i>
                            </div>
                            <h5 class="mb-0">GPU Specifications</h5>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">GPU Model</label>
                                {{ form.gpu_tier }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">GPU Suffix</label>
                                {{ form.gpu_suffix }}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Memory & Storage -->
                    <div class="form-section">
                        <div class="section-icon">
                            <div class="icon-wrapper">
                                <i class="fas fa-memory"></i>
                            </div>
                            <h5 class="mb-0">Memory & Storage</h5>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">RAM Size (GB)</label>
                                {{ form.ram_size_gb }}
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">RAM Type</label>
                                {{ form.ram_type_class }}
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">SSD Size (GB)</label>
                                {{ form.ssd_size_gb }}
                                <small class="text-muted">Enter 0 if no SSD</small>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">HDD Size (GB)</label>
                                {{ form.hdd_size_gb }}
                                <small class="text-muted">Enter 0 if no HDD</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Display -->
                    <div class="form-section">
                        <div class="section-icon">
                            <div class="icon-wrapper">
                                <i class="fas fa-desktop"></i>
                            </div>
                            <h5 class="mb-0">Display</h5>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Screen Size</label>
                                {{ form.screen_size }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Screen Resolution</label>
                                {{ form.resolution_class }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button type="submit" id="predict-submit-btn" class="btn btn-primary btn-predict" data-loading="false">
                            <span class="btn-predict-content">
                                <i class="fas fa-calculator me-2"></i>Predict Price
                            </span>
                            <span class="btn-predict-loading d-none" aria-hidden="true">
                                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                Predicting...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'predictor/js/laptop-form-dropdowns.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    initLaptopFormDropdowns('');
    var predictForm = document.getElementById('predict-form');
    var predictBtn = document.getElementById('predict-submit-btn');
    if (predictForm && predictBtn) {
        var btnContent = predictBtn.querySelector('.btn-predict-content');
        var btnLoading = predictBtn.querySelector('.btn-predict-loading');
        predictForm.addEventListener('submit', function() {
            if (predictBtn.getAttribute('data-loading') === 'true') return;
            predictBtn.setAttribute('data-loading', 'true');
            predictBtn.disabled = true;
            if (btnContent) btnContent.classList.add('d-none');
            if (btnLoading) btnLoading.classList.remove('d-none');
        });
    }
});
</script>
{% endblock %}